
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Bell Harness</title>
    <style>
        body { margin: 0; padding: 0; background-color: #fafafa; }
    </style>
</head>
<body>
    <family-bell id="app"></family-bell>

    <script type="module">
        import { FamilyBellPanel } from './custom_components/family_bell/www/family_bell_panel.js';

        // Mock ha-selector since we don't have the real one
        import { LitElement, html, css } from './custom_components/family_bell/www/lit-element.js';

        class MockHaSelector extends LitElement {
            static get properties() {
                return {
                    hass: { type: Object },
                    selector: { type: Object },
                    value: { type: Object },
                    label: { type: String }
                };
            }
            render() {
                const disabled = this.value === undefined;
                return html`
                    <div style="border: 1px solid #ccc; padding: 10px; border-radius: 4px; background: #fff;">
                        <label>${this.label} (Mock Selector)</label>
                        <div>
                            ${disabled ? html`<span style="color: red;">[Disabled/Undefined]</span>` : html`<span style="color: green;">[Active]</span> Value: ${JSON.stringify(this.value)}`}
                        </div>
                        ${!disabled ? html`<button @click=${() => this.dispatchEvent(new CustomEvent('value-changed', { detail: { value: { ...this.value, media_content_id: "test" } } }))}>Pick Media</button>` : ''}
                    </div>
                `;
            }
        }
        customElements.define('ha-selector', MockHaSelector);

        // Mock Hass
        const mockHass = {
            states: {
                "media_player.kitchen": {
                    attributes: { friendly_name: "Kitchen Speaker" },
                    state: "idle"
                },
                "media_player.living_room": {
                    attributes: { friendly_name: "Living Room" },
                    state: "idle"
                },
                "tts.piper": {
                    attributes: {
                        friendly_name: "Piper",
                        supported_languages: ["en", "de"]
                    },
                    state: "unknown"
                }
            },
            callWS: async (msg) => {
                console.log("WS Call:", msg);
                if (msg.type === "family_bell/get_data") {
                    return {
                        bells: [],
                        vacation: { enabled: false },
                        version: "1.4.2-dev",
                        global_tts: { provider: "tts.piper", language: "en" }
                    };
                }
                if (msg.type === "tts/voices") {
                    // Simulate voices
                    if (msg.engine_id === "tts.piper") {
                         if (msg.language && msg.language !== "en") return { voices: [] };
                         return {
                             voices: [
                                 { voice_id: "en_GB-alan-low", name: "Alan (Low)", language: "en" },
                                 { voice_id: "en_US-amy-low", name: "Amy (Low)", language: "en" }
                             ]
                         };
                    }
                }
                return {};
            }
        };

        const app = document.getElementById('app');

        // Simulate late loading of Hass
        setTimeout(() => {
            app.hass = mockHass;
        }, 500);

    </script>
</body>
</html>
